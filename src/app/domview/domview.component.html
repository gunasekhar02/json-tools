<h2>JSON DOM View</h2>
<p>Paste your JSON and explore it as a collapsible tree structure.</p>

<div style="margin-top: 20px">
  <textarea
    rows="10"
    placeholder="Paste your JSON here..."
    [(ngModel)]="inputJson">
  </textarea>
</div>

<div style="margin: 15px 0">
  <button (click)="loadJson()">Load</button>
  <button class="secondary" (click)="clear()">Clear</button>
</div>

<div *ngIf="error" class="error">{{ error }}</div>

<div *ngIf="json" style="margin-top: 20px">
  <ng-container *ngTemplateOutlet="renderNode; context:{ $implicit: json }"></ng-container>
</div>

<ng-template #renderNode let-node>
  <div class="dom-view-container">
    <div class="node">
      <span *ngIf="isObject(node) || isArray(node)" class="toggle" (click)="toggle(node)">
        {{ node._expanded ? '▼' : '▶' }}
      </span>
      
      <span *ngIf="isArray(node)" class="array-label">
        Array [{{ node.length }}]
      </span>
      
      <span *ngIf="isObject(node)" class="object-label">
        Object
      </span>

      <span *ngIf="!isObject(node) && !isArray(node)" class="value">
        {{ node }}
      </span>

      <div *ngIf="(isArray(node) || isObject(node)) && node._expanded" class="children">
        <ng-container *ngIf="isArray(node)">
          <div class="child" *ngFor="let item of node; let i = index">
            <span class="array-index">[{{ i }}]:</span>
            <ng-container *ngTemplateOutlet="renderNode; context:{ $implicit: item }"></ng-container>
          </div>
        </ng-container>

        <ng-container *ngIf="isObject(node)">
          <div class="child" *ngFor="let key of objectKeys(node)">
            <span class="json-key">"{{ key }}"</span>:
            <ng-container *ngTemplateOutlet="renderNode; context:{ $implicit: node[key] }"></ng-container>
          </div>
        </ng-container>
      </div>
    </div>
  </div>
</ng-template>